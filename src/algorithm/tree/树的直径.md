## 树的直径

给定一棵树，树中每条边都有一个权值，树中两点之间的距离定义为连接两点的路径上的边权之和。树中最远的两个节点之间的距离被称为树的直径，连接这两点的路径被称为树的最长链。后者通常也可称为直径，即直径既是一个数组概念，也可代指一条路径。

### 树形DP求树的直径

对于每个节点，首先递归，求出从该子节点出发，到该节点的叶子结点的最长路径。显然，当前节点到叶子结点的最长路径就是这些子节点中的最大值。

```cpp
// 返回最长的路径
int dfs(int cur, int pre){
    int len1 = 0, len2 = 0;
    // 扫描所有子节点
    for(int edge = head[cur];edge>0;edge=ne[edge]){
        int y = ver[edge];
        if(y == pre){
            continue;
        }
        int len = dfs(y,cur) + w[edge];
        if(len > len1){
            len2 = len1;
            len1 = len;
        }else if(len > len2){
            len2 = len;
        }
    }
    res = max(res,len1 + len2);
    return len1;
}
```

### 两次BFS求树的直径

这种做法包括两步：

1. 从任意一个节点出发，通过 BFS 或 DFS 对树进行一次遍历，求出与出发点距离最远的节点，记为 p。
2. 从节点 p 出发，通过 BFS 或 DFS 再进行一次遍历，求出与 p 距离最远的节点，记为 q。

从 p 到 q 的路径就是树的一条直径。这是因为 p 一定是直径的一端，否则总能找到一条更长的链，与直径的定义矛盾。既然 p 是直径的一端，那么与 p 距离最远的 q 当然就是直径的另一端了。